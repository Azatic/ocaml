# Makefile.build_config.  Generated from Makefile.build_config.in by configure.

#**************************************************************************
#*                                                                        *
#*                                 OCaml                                  *
#*                                                                        *
#*                 David Allsopp, OCaml Labs, Cambridge.                  *
#*                                                                        *
#*   Copyright 2020 MetaStack Solutions Ltd.                              *
#*                                                                        *
#*   All rights reserved.  This file is distributed under the terms of    *
#*   the GNU Lesser General Public License version 2.1, with the          *
#*   special exception on linking described in the file LICENSE.          *
#*                                                                        *
#**************************************************************************

# This Makefile contains configuration gleaned by configure but which should not
# be installed in Makefile.config. The file is designed to be included in
# OCaml's build system and so itself includes Makefile.config. It assumes that
# $(ROOTDIR) has been defined.

# This variable is added to prevent double-inclusion of this Makefile by
# Makefile.config_if_required. override is used as this has highest $(origin )
# priority (including over make BUILD_CONFIG_INCLUDED)
override BUILD_CONFIG_INCLUDED =

include $(ROOTDIR)/Makefile.config
INSTALL ?= /usr/bin/install -c -p
INSTALL_DATA ?= ${INSTALL} -m 644
INSTALL_PROG ?= ${INSTALL}

# Whether to build certain libraries and tools

build_ocamldebug = false

build_ocamldoc = false

build_ocamltex = false

lib_dynlink = true
lib_runtime_events = true
lib_str = false
lib_systhreads = false
lib_unix = false

# Whether to install the native toplevel (ocamlnat)
INSTALL_OCAMLNAT = false

# The command to generate C dependency information
DEP_CC=gcc-13 -MM
COMPUTE_DEPS=false

# Build-system flags to use to compile C files
OC_CFLAGS=-O2 -fno-strict-aliasing -fwrapv -pthread -g -Wall -Wint-conversion -Wstrict-prototypes -Wold-style-definition -Werror -fno-common -fexcess-precision=standard -Wvla
OC_CPPFLAGS=-I$(ROOTDIR)/runtime  -D_FILE_OFFSET_BITS=64 

# The following variable defines flags to be passed to the C preprocessor
# when compiling C files to be linked with native code. This includes
# the native runtime itself and can also include the stub code around
# C libraries when it needs to be different from the one used to
# link with bytecode.

# These flags should be passed *in addition* to those in OC_CPPFLAGS, they
# should not replace them.

OC_NATIVE_CPPFLAGS=-DNATIVE_CODE -DTARGET_riscv -DMODEL_riscv64 -DSYS_linux

# Same as above, for CFLAGS
OC_NATIVE_CFLAGS=

# Additional link-time options
# To support dynamic loading of shared libraries (they need to look at
# our own symbols):
OC_LDFLAGS= -Wl,-E
OC_DLL_LDFLAGS=
OC_EXE_LDFLAGS=

MKEXE_VIA_CC=\
  $(CC) $(OC_EXE_LDFLAGS) $(OC_CFLAGS) $(CFLAGS) $(OC_LDFLAGS) $(LDFLAGS) $(OUTPUTEXE)$(1) $(2)

# Which tool to use to display differences between files
DIFF=
# Which flags to pass to the diff tool
DIFF_FLAGS=

# The rlwrap command (for the *runtop targets)
RLWRAP=

# The best sed which is available (GNU sed if available)
SED=/usr/bin/sed

# Which document generator: odoc or ocamldoc?
DOCUMENTATION_TOOL=ocamldoc
DOCUMENTATION_TOOL_CMD=ocamldoc

# The location of the FlexDLL sources to use (usually provided as the flexdll
# Git submodule)
FLEXDLL_SOURCES=
BOOTSTRAPPING_FLEXDLL=false

### Where to install documentation
PACKAGE_TARNAME = ocaml
datarootdir = ${prefix}/share
DOCDIR=${datarootdir}/doc/${PACKAGE_TARNAME}

ocamltest_unix_impl = dummy
ocamltest_unix_name = 
ocamltest_unix_path = 
ocamltest_unix_include = $(EMPTY)

# Which make target to build, depending on whether the native compiler
# has been enabled or not during the configuration stage

DEFAULT_BUILD_TARGET = world.opt

# Flags to use when compiling and linking OCaml programs

# The names of the variables below take the form XXX_YYY_ZZZ where
#
# XXX is one of OC, OCAML or the lower-case name of a module. The OC prefix
# is for private variables (i.e. reserved by the compiler's build system),
# the OCAML prefix is used for variables users can define to add their
# own flags and the module-name prefix is for flags that apply only
# to one module.
#
# YYY refers to the backend. At the moment, it can take the values
# COMMON for the flags shared by all the backends, BYTECODE or NATIVE
# (other backends may be added in the future).
#
# ZZZ is either COMPFLAGS (compile-time flags) or LINKFLAGS (link-time flags).
# Countrary to the C convention wrt. CFLAGS and LDFLAGS, the flags in the
# COMPFLAGS category are not passed at link time, so if a flag is needed
# at both stages, like e.g. -g, it should be added to both
# XXX_YYY_COMPFLAGS and XXX_YYY_LINKFLAGS.

OC_COMMON_COMPFLAGS = -g -strict-sequence -principal -absname \
  -w +a-4-9-40-41-42-44-45-48 -warn-error +a -bin-annot \
  -strict-formats
OC_COMMON_LINKFLAGS = $(INCLUDES)

OC_BYTECODE_LINKFLAGS =

OC_NATIVE_COMPFLAGS = 

OC_NATIVE_LINKFLAGS = -g

# Platform-dependent command to create symbolic links
LN = ln -sf

# Platform-dependent assembler files to use to build the runtime
runtime_ASM_OBJECTS = $(addprefix runtime/,riscv.o)

# Platform-dependent module for ocamlyacc
ocamlyacc_WSTR_MODULE = 
